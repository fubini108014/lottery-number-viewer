name: 每日自動更新號碼並部署網頁

on:
  schedule:
    # 台灣時間 20:34 執行 (UTC 12:34)
    # - cron: '34 12 * * *'
    # 台灣時間 20:46 執行 (UTC 12:46)
    - cron: '46 12 * * *'
    # 台灣時間 20:50 執行 (UTC 12:50)
    - cron: '50 12 * * *'
  workflow_dispatch: # 讓你可以手動點擊執行測試

jobs:
  update-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: 檢出程式碼
        uses: actions/checkout@v4
        with:
          # 確保抓取完整歷史，避免部署失敗
          fetch-depth: 0

      - name: 設定 Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: 安裝 Python 必要套件
        run: pip install requests beautifulsoup4

      - name: 執行爬蟲更新 JSON
        run: python scraper.py

      - name: 提交 JSON 資料更新
        run: |
          git config --global user.name "GitHub Bot"
          git config --global user.email "bot@github.com"
          git add public/data/*.json public/files.json
          # 如果沒有變動（例如當天沒開獎），就不會報錯退出
          git commit -m "Auto update lotto data: $(date +'%Y-%m-%d %H:%M')" || echo "No changes to commit"
          git push

      - name: 設定 Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20' # 建議使用目前的穩定版

      - name: 安裝前端套件並打包 (Build)
        run: |
          npm install
          npm run build

      - name: 部署到 GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: dist # 你的 Vite 打包目錄
          branch: gh-pages # 部署到的分支